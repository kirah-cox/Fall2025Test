@page "/experiment"
@inject IJSRuntime JSRuntime
@using Microsoft.Extensions.DependencyInjection
@using Microsoft.JSInterop


@code {

    class SpaceShip
    {
        public double Velocity;
        public int PositionX;
        public int PositionY;
        public int RotationAngle;

        public SpaceShip()
        {
            Velocity = 0;
            PositionX = 600;
            PositionY = 600;
            RotationAngle = 0;
        }

        public void Move()
        {
            if (keyPressed == "W" && Velocity < 8)
                Velocity += 0.25;

            if (keyPressed == "S" && Velocity > 0)
                Velocity -= 0.25;

            if (keyPressed == "A")
                RotationAngle++;

            if (keyPressed == "D")
                RotationAngle--;
        }
    }

    private DotNetObjectReference<Experiment>? _dotNetRef;
    private static string keyPressed = "None";
    private SpaceShip _SpaceShip = new SpaceShip();

    protected override void OnInitialized()
    {
        _ = RunGameUpdate(_SpaceShip);
    }

    private async Task RunGameUpdate(SpaceShip spaceShip)
    {
        while (true)
        {
            spaceShip.Move();
            spaceShip.PositionY -= (int)Math.Round(Math.Sin((spaceShip.RotationAngle * 2 * Math.PI) / 360) * spaceShip.Velocity);
            spaceShip.PositionX += (int)Math.Round(Math.Cos((spaceShip.RotationAngle * 2 * Math.PI) / 360) * spaceShip.Velocity);

            if (keyPressed == "None" && spaceShip.Velocity > 0)
                spaceShip.Velocity -= 0.05;

            await Task.Delay(16);
            await InvokeAsync(StateHasChanged);
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _dotNetRef = DotNetObjectReference.Create(this);
            await JSRuntime.InvokeVoidAsync("keyHandler.initialize", _dotNetRef);
        }
    }

    [JSInvokable]
    public async Task OnKeyDown(string key)
    {
        keyPressed = key.ToUpper();
        // Console.WriteLine("Key pressed: " + lastKeyPressed);
        await InvokeAsync(StateHasChanged);
    }

    [JSInvokable]
    public void OnKeyUp(string key)
    {
        keyPressed = "None";
    }

    public void DisposeAsync()
    {
        _dotNetRef?.Dispose();
    }
}

<head>
    <PageTitle>Experiment</PageTitle>
</head>


<div class="whole-about-me-page">
    <div class="main-body-about-me">
        <p>Key Pressed: @(keyPressed == " " ? "Spacebar" : keyPressed)</p>
        <div style="color: #F1F0EF; position: absolute; top: @(_SpaceShip.PositionY)px; left: @(_SpaceShip.PositionX)px; transform: rotate(@(-_SpaceShip.RotationAngle)deg);">
            <svg fill="#F1F0EF" height="4rem" width="4rem" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 96.522 96.522" xml:space="preserve" stroke="#F1F0EF" transform="rotate(90)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <path d="M74.692,65.181l-9.044-7.321c1.319-5.557,1.988-11.532,1.988-17.761c0-19.963-14.052-38.367-18.719-39.988 c-0.426-0.147-0.887-0.147-1.313,0c-4.667,1.621-18.719,20.025-18.719,39.988c0,6.229,0.669,12.205,1.99,17.761l-9.045,7.321 c-0.541,0.438-0.815,1.127-0.724,1.817l3.69,27.787c0.104,0.787,0.663,1.438,1.425,1.658c0.765,0.22,1.582-0.029,2.092-0.638 l14.413-17.225c3.543,2.163,7.527,2.163,11.07,0l14.411,17.225c0.387,0.461,0.951,0.717,1.534,0.717 c0.186,0,0.373-0.026,0.558-0.079c0.762-0.221,1.32-0.871,1.425-1.658l3.69-27.787C75.507,66.309,75.233,65.619,74.692,65.181z M48.262,39.619c-4.418,0-8-3.582-8-8s3.582-8,8-8s8,3.582,8,8S52.68,39.619,48.262,39.619z"></path> </g> </g></svg>
        </div>
    </div>
    <footer class="whole-footer">
        <div class="footer-name">
            Kirah Cox
        </div>
        <div class="social-media-logos">
            <a href="https://www.facebook.com/kiriosity02" target="_blank">
                <svg fill="#F1F0EF" height="4rem" width="4rem" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon" stroke="#F1F0EF">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round"
                       stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-92.4 233.5h-63.9c-50.1
                    0-59.8 23.8-59.8 58.8v77.1h119.6l-15.6 120.7h-104V912H539.2V602.2H434.9V481.4h104.3v-89c0-103.3 63.1-159.6 155.3-159.6 44.2 0 82.1 3.3 93.2 4.8v107.9z"></path>
                    </g>
                </svg>
            </a>
            <a href="https://www.instagram.com/kirah_cox" target="_blank">
                <svg viewBox="0 0 24 24" height="4rem" width="4rem" xmlns="http://www.w3.org/2000/svg" fill="#F1F0EF">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <g>
                            <path fill="none" d="M0 0h24v24H0z"></path> <path fill-rule="nonzero" d="M12 2c2.717 0 3.056.01 4.122.06 1.065.05 1.79.217 2.428.465.66.254 1.216.598 1.772 1.153a4.908
                    4.908 0 0 1 1.153 1.772c.247.637.415 1.363.465 2.428.047 1.066.06 1.405.06 4.122 0 2.717-.01 3.056-.06 4.122-.05 1.065-.218 1.79-.465 2.428a4.883 4.883 0 0 1-1.153 1.772 4.915 4.915 0 0 1-1.772
                    1.153c-.637.247-1.363.415-2.428.465-1.066.047-1.405.06-4.122.06-2.717 0-3.056-.01-4.122-.06-1.065-.05-1.79-.218-2.428-.465a4.89 4.89 0 0 1-1.772-1.153 4.904 4.904 0 0 1-1.153-1.772c-.248-.637-.415-1.363-.465-2.428C2.013 15.056
                    2 14.717 2 12c0-2.717.01-3.056.06-4.122.05-1.066.217-1.79.465-2.428a4.88 4.88 0 0 1 1.153-1.772A4.897 4.897 0 0 1 5.45 2.525c.638-.248 1.362-.415 2.428-.465C8.944 2.013 9.283 2 12 2zm0 5a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm6.5-.25a1.25
                    1.25 0 0 0-2.5 0 1.25 1.25 0 0 0 2.5 0zM12 9a3 3 0 1 1 0 6 3 3 0 0 1 0-6z"></path>
                        </g>
                    </g>
                </svg>
            </a>
            <a href="https://www.linkedin.com/in/kirah-cox-38b7b4398" target="_blank">
                <svg fill="#F1F0EF" style="margin-top: 6px; padding-left: 7px;" height="3.25rem" width="3.25rem" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-143 145 512 512" xml:space="preserve" stroke="#F1F0EF"><g id="SVGRepo_bgCarrier"
                                                                                                                                                                                                                                                                                              stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier">
                <path d="M329,145h-432c-22.1,0-40,17.9-40,40v432c0,22.1,17.9,40,40,40h432c22.1,0,40-17.9,40-40V185C369,162.9,351.1,145,329,145z M41.4,508.1H-8.5V348.4h49.9V508.1z M15.1,328.4h-0.4c-18.1,0-29.8-12.2-29.8-27.7c0-15.8,12.1-27.7,30.5-27.7
                    c18.4,0,29.7,11.9,30.1,27.7C45.6,316.1,33.9,328.4,15.1,328.4z M241,508.1h-56.6v-82.6c0-21.6-8.8-36.4-28.3-36.4 c-14.9,0-23.2,10-27,19.6c-1.4,3.4-1.2,8.2-1.2,13.1v86.3H71.8c0,0,0.7-146.4,0-159.7h56.1v25.1c3.3-11,21.2-26.6,49.8-26.6
                    c35.5,0,63.3,23,63.3,72.4V508.1z"></path> </g></svg>
            </a>
        </div>
    </footer>
</div>